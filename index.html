<!-- Botón WhatsApp + Función de pedido añadida -->
<div id="pedido" style="margin:20px auto; max-width:500px; background:#fff; border-radius:10px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); text-align:left;">
  <h2>Mi Pedido</h2>
  <ul id="lista-pedido"></ul>
  <p id="total-pedido"></p>
  <button id="enviar-whatsapp" style="background-color:green; color:white; padding:10px 15px; border:none; border-radius:5px; cursor:pointer;">Enviar pedido por WhatsApp</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const modal = document.getElementById('modal');
    const modalTitulo = document.getElementById('modal-titulo');
    const btnEntera = document.getElementById('btn-entera');
    const btnMitad = document.getElementById('btn-mitad');
    const btnCancelar = document.getElementById('btn-cancelar');

    const listaPedido = document.getElementById('lista-pedido');
    const totalPedido = document.getElementById('total-pedido');
    const btnWhatsapp = document.getElementById('enviar-whatsapp');

    let productosGlobal = {};
    let pedido = [];

    btnCancelar.onclick = () => modal.style.display = 'none';

    btnEntera.onclick = () => agregarAlPedido('Entera');
    btnMitad.onclick = () => agregarAlPedido('Mitad');

    function agregarAlPedido(tipo) {
      const nombre = modalTitulo.textContent;
      const info = productosGlobal[nombre];
      let precio = info.precio;
      if (tipo === 'Mitad') precio = Math.round(precio / 2);
      pedido.push({ nombre, tipo, precio });
      actualizarPedido();
      modal.style.display = 'none';
    }

    function actualizarPedido() {
      listaPedido.innerHTML = '';
      let total = 0;
      pedido.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.nombre} (${p.tipo}) - Gs. ${p.precio.toLocaleString()}`;
        listaPedido.appendChild(li);
        total += p.precio;
      });
      totalPedido.textContent = `Total: Gs. ${total.toLocaleString()}`;
    }

    btnWhatsapp.onclick = () => {
      if (pedido.length === 0) return alert('No hay nada en el pedido');
      const mensaje = pedido.map(p => `- ${p.nombre} (${p.tipo})`).join('%0A');
      const total = pedido.reduce((sum, p) => sum + p.precio, 0);
      const texto = `Hola! Quiero pedir:%0A${mensaje}%0A%0ATotal: Gs. ${total.toLocaleString()}`;
      window.open(`https://wa.me/+595986398701?text=${texto}`, '_blank');
    }

    try {
      const res = await fetch("https://raw.githubusercontent.com/1967-ROB/Precios-alo-rico/main/precios.json");
      const productos = await res.json();
      productosGlobal = productos;

      const menu = document.getElementById('menu');
      menu.innerHTML = '';

      Object.entries(productos).forEach(([nombre, info]) => {
        const card = document.createElement('div');
        card.className = 'product';

        card.innerHTML = `
          <img src="${info.imagen}" alt="${nombre}">
          <h3>${nombre}</h3>
          <p>Gs. ${info.precio.toLocaleString()}</p>
        `;

        card.addEventListener('click', () => {
          modalTitulo.textContent = nombre;
          modal.style.display = 'flex';
        });

        menu.appendChild(card);
      });

    } catch (error) {
      document.getElementById('menu').innerHTML = "<p style='color:red;'>No se pudo cargar el menú</p>";
      console.error(error);
    }
  });
</script>
